# Enable CORS for app2_live - Dynamic origin handling
<IfModule mod_headers.c>
    # Check if origin is in allowed list and set CORS_ALLOW_ORIGIN
    SetEnvIf Origin "^https://kpi-nodelive\.localhost$" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "^http://localhost:3001$" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "^https://localhost:3001$" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "^https://live\.kayak-polo\.info$" CORS_ALLOW_ORIGIN=$0

    # Set CORS headers for allowed origins
    Header always set Access-Control-Allow-Origin "%{CORS_ALLOW_ORIGIN}e" env=CORS_ALLOW_ORIGIN
    Header always set Access-Control-Allow-Credentials "true" env=CORS_ALLOW_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, OPTIONS" env=CORS_ALLOW_ORIGIN
    Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, X-Auth-Token" env=CORS_ALLOW_ORIGIN
    Header always set Access-Control-Max-Age "3600" env=CORS_ALLOW_ORIGIN
</IfModule>

# Handle OPTIONS requests (preflight)
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Handle preflight OPTIONS requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Set proper MIME types for JSON files
<IfModule mod_mime.c>
    AddType application/json .json
</IfModule>

# Enable caching for JSON files (short duration for live data)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType application/json "access plus 10 seconds"
</IfModule>
